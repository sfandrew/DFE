<style type="text/css">
  th{
    text-align: center;
    vertical-align: middle;
  }
  .table > thead > tr > th {
    vertical-align: middle;
  }
  td{
    text-align: center;
  }

</style>
<div class="row">
  <h1 class="col-md-6" id="main-header">
    <% if @dynamic_form_type %>
      <%= pluralize(@dynamic_form_entries.size, @dynamic_form_type.name) %>

    <% else %>
      <%= pluralize(@dynamic_form_entries.size, 'Entry') %>
    <% end %>
  </h1>
  <div class="col-md-6">
    <%= link_to 'Edit', edit_dynamic_form_type_path(@dynamic_form_type), class: 'btn btn-primary pull-right' %>
    <%= link_to "CSV", '#', class: 'btn btn-info pull-right' %>
    <%= link_to "Excel", '#', class: 'btn btn-info pull-right' %>
  </div>
</div>

<fieldset>
  <%= form_for(:search, :url => dynamic_form_entries_path, :html => { :method => :get }) do  %>
    <div class="row">
      <div class="col-xs-6 col-sm-3">
        <select name="search[name]" class="form-control">
          <%=raw "<option value=\"\">[ALL]</option>" %>
          <%= options_for_select(@entries_name) %>
        </select>
      </div>
      <div class="col-xs-3 col-sm-3">
        <%=raw text_field 'search', 'properties', :class => "col-xs-6 form-control", :placeholder => "Enter properties like" %>
      </div>
      <div class="col-md-3">
        <div class="input-daterange input-group date">
          <%= text_field 'search', 'start', :class => "form-control", :placeholder => "Start Date" %>
          <span class="input-group-addon">to</span>
           <%= text_field 'search', 'end', :class => "form-control", :placeholder => "End Date" %>
        </div>
      </div>
      <%= link_to "Reset", dynamic_form_entries_path, :class => 'btn btn-danger col-sm-1' %>
      <div class="col-xs-6 col-sm-2">
        <button type="submit" class="btn btn-info btn-block"><i class="fa fa-search"></i> Search</button>
      </div>
    </div>
  <% end %>
</fieldset>

<%= content_tag :div, nil, class: 'clear spacer' %>

<table class="table table-striped table-hover">
  <thead>
    <tr class="well">
      <% if !@dynamic_form_type %>
        <th>Type</th>
        <th>Properties</th>
      <% end %>
      <th>Status</th>
      <% if !@dynamic_form_type.nil? %>
        <% @dynamic_form_type.fields.each do |field| %>
          <% if field.included_in_report %>
            <th align="center">
              <%= field.name %>
              <h6>(<%= field.field_type.titleize  %>)</h6>
            </th>
          <% end %>
        <% end %>
      <% end %>
      <th>Submitted</th>
      <th></th>
      <th></th>
    </tr>
  </thead>


  <tbody>
    <% if @dynamic_form_entries %>
      <% @dynamic_form_entries.each do |dynamic_form_entry| %>
        <tr>
          <% if !@dynamic_form_type %>
            <td><strong><%= dynamic_form_entry.dynamic_form_type.name %></strong></td>
            <td class="form-properties">
              <% if !dynamic_form_entry.properties.empty? %>
                <% dynamic_form_entry.properties.first(5).each do  |key,value| %>
                  <li><%= value[:type]%> field</li>
                <% end %>
              <% else %>
                No Properties
              <% end %>
            </td>
          <% end %>
          <td>
            <% if dynamic_form_entry.in_progress %>
              <%= link_to edit_dynamic_form_entry_path(dynamic_form_entry), :class => 'btn btn-danger' do %>
                <i class="fa fa-pencil-square-o"></i> IN DRAFT
              <% end %>
            <% else %>
              <%= link_to dynamic_form_entry, :class => 'btn btn-success' do %>
                <i class="fa fa-check"></i> SUBMITTED
              <% end %>
            <% end %>
          </td>
          <% if !@dynamic_form_type.nil? %>
            <% @dynamic_form_type.fields.each do |field| %>
              <% if field.included_in_report %>
                <% if field.field_type == "agreement" || field.field_type == "check_box" %>
                  <td>
                    <%= "Approve" if dynamic_form_entry.properties.find { |key, value| value[:id].to_i == field.id } %>
                  </td>
                <% else %>
                  <td>
                    <% if !dynamic_form_entry.properties.blank? %>
                      <%#= dynamic_form_entry.properties.find { |key, value|  value[:id].to_i == field.id }[1][:value] %>
                      <%= dynamic_form_entry.get_property_value(field.id) %>
                      <%#= field.id %>
                    <% end %>
                  </td>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
          <td><%= dynamic_form_entry.created_at.strftime(" %l:%M %p %b. %d, %Y") %></td>
          <td><%= link_to 'Show', dynamic_form_entry, :class => 'btn btn-info' %></td>
          <!-- td><%= link_to 'Edit', edit_dynamic_form_entry_path(dynamic_form_entry) %></td -->
          <td><%= link_to 'Delete', dynamic_form_entry, method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger' %></td>
        </tr>
      <% end %>
    <% else %>
      <tr>
        <td>You have no entries!</td>
      </tr>
    <% end %>
  </tbody>
</table>

<script type="text/javascript">
  $(document).ready(function(){
    $('.date input').datepicker({
    });
  });
</script>


