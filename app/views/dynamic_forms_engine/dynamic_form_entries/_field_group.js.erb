
var DFE = DFE || {};  

//doc rdy
$(function(){
	DFE.initStepForm();

	//adding badges to breadcrumbs when form errors
	$(window).on('load', function(){
		DFE.formErrorBadges();
	});

	//next step
	$('.next').on('click', function(){
		DFE.nextStep( $('.field-group') );
	});

	//prev
	$('.previous').on('click', function(){
		DFE.prevStep( $('.field-group') );
	});

	//breadcrumbs
	$('.btn-breadcrumb a').on('click', function(){
		var $this = $(this);
		DFE.resetBreadcrumb();
		DFE.toggleBreadcrumb( $this );
		DFE.gotoStep( $this.data('step-id') );
	});

	//tooltips
	$('.dfe-tooltip').tooltip();


});



DFE.initStepForm = function(){
	$('.field-group:eq(0)').addClass('active');
	DFE.toggleBreadcrumb( $('.btn-breadcrumb a:eq(0)') ) ;
}	

DFE.formErrorBadges = function(){
	//$('.field-group').each
		//$('.error-msg').size
		// update breadcrumb with SIZE
	if ($('.error-msg').length > 0) {
		var error_fields = $('.error-msg').closest('fieldset');
		for (i = 0; i < error_fields.length; i++) {
			var fieldset_id = error_fields.eq(i).attr('id');
			var number_of_errors = error_fields.eq(i).find('.error-msg').length;
			DFE.updateBreadcrumb(fieldset_id, number_of_errors);
			// var breadcrumb_id = $('.btn-breadcrumb a').data('step-id');
			// if (breadcrumb_id == fieldset_id){
			// 	console.log("I found it!" + i);
			// }
		}
		
	}
}

DFE.updateBreadcrumb = function(field_id,num_errors){

	console.log("I was called with", field_id, num_errors);

	var $breadcrumbToUpdate = $('.btn-breadcrumb a[data-step-id=' + field_id + ']');

	$breadcrumbToUpdate.text(num_errors);


	var badge_number = $('.alert-d')


	// $('.btn-breadcrumb').find('a').data(field_id).text(num_errors);

	// console.log("Is this working?");
}

DFE.toggleBreadcrumb = function($breadcrumb){

	if( $breadcrumb.hasClass('btn-primary') ){
		$breadcrumb.removeClass('btn-primary');
		$breadcrumb.addClass('btn-default');
	}else if( $breadcrumb.hasClass('btn-default') ){
		$breadcrumb.removeClass('btn-default');
		$breadcrumb.addClass('btn-primary');
	}

}

DFE.resetBreadcrumb = function(){
	$('.btn-breadcrumb a')
		.removeClass('btn-primary')
		.removeClass('btn-default')
		.addClass('btn-default');
}


DFE.nextStep = function($field_group){
	$.each( $field_group, function(i, field){
		
		var $field = $(field);

		//if last
		if(i+1 === $field_group.length){
			DFE.resetBreadcrumb();
			DFE.toggleBreadcrumb( $('.btn-breadcrumb a:eq(0)') );
			DFE.gotoStep( $('.field-group:eq(0)').attr('id') );
		}

		if($field.hasClass('active')){
			$field.removeClass('active');
			$field_group.eq(i+1).addClass('active');
			DFE.resetBreadcrumb();
			DFE.toggleBreadcrumb( $('.btn-breadcrumb a').eq(i+1) );		
			return false;
		}

	});
}

DFE.prevStep = function($field_group){
	$.each( $field_group, function(i, field){
		
		var $field = $(field);

		if($field.hasClass('active')){
			$field.removeClass('active');
			$field_group.eq(i-1).addClass('active');
			DFE.resetBreadcrumb();
			DFE.toggleBreadcrumb( $('.btn-breadcrumb a').eq(i-1) );
			return false;
		}

	});
}

DFE.gotoStep = function(step_id){
	var $step = $('#'+step_id);

	$('.field-group').removeClass('active');
	$step.addClass('active');

}